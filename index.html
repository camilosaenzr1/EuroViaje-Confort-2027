<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EuroPlan Master 2027</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfdfd; }
        .serif { font-family: 'Playfair Display', serif; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .city-card.active { border-color: #1e293b; background-color: #f8fafc; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        #map { height: 500px; border-radius: 32px; border: 8px solid white; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.05); }
        .custom-range::-webkit-scrollbar { width: 4px; }
        .custom-range::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-900 overflow-hidden">

<div class="flex h-screen">
    <aside class="w-96 bg-white border-r border-slate-100 p-8 overflow-y-auto custom-range">
        <div class="mb-10">
            <h1 class="serif text-3xl text-slate-900">EuroPlan 2027</h1>
            <p class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-600 mt-2">Log√≠stica de Confort para 13 Personas</p>
        </div>

        <div class="space-y-8">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase">TRM 1‚Ç¨ = COP</label>
                    <input type="number" id="trm" value="4750" oninput="render()" class="w-full mt-1 font-bold text-slate-800 border-b-2 border-slate-100 outline-none focus:border-blue-500 py-1">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase">D√≠as Totales</label>
                    <input type="number" id="maxDias" value="15" readonly class="w-full mt-1 font-bold text-slate-400 bg-transparent border-none">
                </div>
            </div>

            <div>
                <label class="text-[10px] font-bold text-slate-400 uppercase">Nivel de Confort</label>
                <select id="confort" onchange="render()" class="w-full mt-2 p-3 rounded-xl bg-slate-50 text-sm font-semibold border-none ring-1 ring-slate-100">
                    <option value="premium">üíé Premium (100% Privado)</option>
                    <option value="balance" selected>‚öñÔ∏è Balanceado (Mix)</option>
                    <option value="eco">üöá P√∫blico (Agotador)</option>
                </select>
            </div>

            <div>
                <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Elegir Destinos</h3>
                <div id="cityContainer" class="space-y-3"></div>
            </div>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto p-10 bg-[#fafafa] custom-range">
        <div class="max-w-6xl mx-auto space-y-10">
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                <div class="lg:col-span-2">
                    <div id="map"></div>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-white p-8 rounded-[32px] shadow-sm border border-slate-100">
                        <h4 class="text-[10px] font-bold text-slate-400 uppercase mb-6 tracking-widest">Inversi√≥n Individual</h4>
                        <div id="financialTable" class="space-y-4"></div>
                        <div class="mt-8 pt-6 border-t">
                            <p class="text-4xl font-black text-slate-900 tracking-tighter" id="totalPersonaCOP">$ 0</p>
                            <p class="text-lg font-semibold text-blue-600 italic" id="totalPersonaEUR">‚Ç¨ 0</p>
                        </div>
                    </div>

                    <div id="healthMetric" class="p-6 rounded-[24px]"></div>
                </div>
            </div>

            <div id="itineraryDetail" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
        </div>
    </main>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const database = [
        { id: 'bcn', name: 'Barcelona', lat: 41.38, lng: 2.17, img: 'https://images.unsplash.com/photo-1583422409516-2895a77efded?w=800', h: 95, fatigue: 'Bajo', activities: ["Sagrada Familia", "Playa Barceloneta", "Barrio G√≥tico"] },
        { id: 'par', name: 'Par√≠s', lat: 48.85, lng: 2.35, img: 'https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=800', h: 120, fatigue: 'Medio', activities: ["Torre Eiffel", "Louvre", "Disneyland"] },
        { id: 'rom', name: 'Roma', lat: 41.90, lng: 12.49, img: 'https://images.unsplash.com/photo-1552832230-c0197dd311b5?w=800', h: 110, fatigue: 'Muy Alto', activities: ["Coliseo", "Vaticano", "Trastevere"] },
        { id: 'zrh', name: 'Z√∫rich', lat: 47.37, lng: 8.54, img: 'https://images.unsplash.com/photo-1527668752968-14dc70a27c95?w=800', h: 160, fatigue: 'Bajo', activities: ["Museo Lindt", "Lago de Z√∫rich"] },
        { id: 'vie', name: 'Viena', lat: 48.20, lng: 16.37, img: 'https://images.unsplash.com/photo-1516550893923-42d28e5677af?w=800', h: 100, fatigue: 'Bajo', activities: ["Palacio Sch√∂nbrunn", "√ìpera de Viena"] },
        { id: 'ven', name: 'Venecia', lat: 45.44, lng: 12.31, img: 'https://images.unsplash.com/photo-1523906834658-6e24ef2386f9?w=800', h: 135, fatigue: 'Muy Alto', activities: ["G√≥ndola", "Plaza San Marcos", "Murano"] },
        { id: 'lux', name: 'Luxemburgo', lat: 49.61, lng: 6.13, img: 'https://images.unsplash.com/photo-1563813732-757f49514782?w=800', h: 120, fatigue: 'Medio', activities: ["Casamatas del Bock", "Ciudad Alta"] }
    ];

    let selection = [];
    let map = L.map('map', {zoomControl: false}).setView([48, 12], 4);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);
    let markers = [];

    function init() {
        const container = document.getElementById('cityContainer');
        database.forEach(c => {
            container.innerHTML += `
                <div onclick="toggleCity('${c.id}')" id="card-${c.id}" class="city-card cursor-pointer p-4 rounded-2xl border-2 border-slate-50 bg-white transition-all flex items-center justify-between group">
                    <span class="font-bold text-slate-700">${c.name}</span>
                    <span class="text-xs text-slate-300 group-hover:text-blue-500">Ôºã</span>
                </div>
            `;
        });
        render();
    }

    function toggleCity(id) {
        const i = selection.indexOf(id);
        if (i > -1) selection.splice(i, 1);
        else if (selection.length < 5) selection.push(id);
        else alert("M√°ximo 5 ciudades para mantener el confort en 15 d√≠as");
        
        document.querySelectorAll('.city-card').forEach(card => card.classList.remove('active'));
        selection.forEach(sid => document.getElementById('card-'+sid).classList.add('active'));
        render();
    }

    function render() {
        const trm = document.getElementById('trm').value;
        const conf = document.getElementById('confort').value;
        const totalDias = 15;
        const diasPorCiudad = selection.length > 0 ? Math.floor(totalDias / selection.length) : 0;
        
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        
        let subtotal = { hotel: 0, meal: 35 * totalDias, transport: 0, tiquete: 1100 };
        const itin = document.getElementById('itineraryDetail');
        itin.innerHTML = "";

        selection.forEach(sid => {
            const city = database.find(x => x.id === sid);
            subtotal.hotel += city.h * diasPorCiudad;
            subtotal.transport += (conf === 'premium' ? 45 : (conf === 'balance' ? 20 : 7)) * diasPorCiudad;

            let m = L.marker([city.lat, city.lng]).addTo(map);
            markers.push(m);

            itin.innerHTML += `
                <div class="bg-white rounded-[32px] overflow-hidden shadow-sm border border-slate-100">
                    <div class="h-44 bg-cover bg-center" style="background-image:url('${city.img}')"></div>
                    <div class="p-8">
